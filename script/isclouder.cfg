# Kickstart file automatically generated by anaconda.

install
cdrom
graphical
firstboot --enable
lang zh_CN.UTF-8
keyboard --vckeymap=us --xlayouts='us'
timezone Asia/Shanghai --isUtc
xconfig  --startxonboot
#bootloader --location=mbr --boot-drive=sda
#clearpart --all --initlabel --drives=sda
autopart --type=lvm
services --disabled="chronyd"
reboot --eject

%packages
@center-dep
@center
%end

%post
rm /etc/yum.repos.d/* -rf

echo "ISCLOUDER Linux release V4" > /etc/centos-release
sed -i '1c ISCLOUDER Linux release V4' /etc/issue
sed -i '1c ISCLOUDER Linux release V4' /etc/issue.net
sed -i 's/rhgb/ /g' /boot/grub2/grub.cfg
sed -i 's/CentOS/ISCLOUDER/g' /boot/grub2/grub.cfg

systemctl disable firewalld
systemctl enable iptables
systemctl enable nfs-server
systemctl enable mplatform 

sed -i '10a\-A INPUT -p tcp --dport 80 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p icmp -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -i lo -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 54321 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 16514 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 22 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 24007 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 24009:24109 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp -m multiport --dports 5634:6166 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp -m multiport --dports 49152:49216 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 161 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 6666 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 6660 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 69 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p udp --dport 69 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 6200 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p tcp --sport 6200 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p TCP --dport 80 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p TCP --dport 4200 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p UDP --dport 10140 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 20048 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 443 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 5432 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 32803 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 6100 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p tcp --dport 6100 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 32769 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 2049 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 892 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 892 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 875 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 875 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 662 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 662 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 111 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 111 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 123 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p udp --dport 123 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 6661 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p udp --dport 6661 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 69 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A OUTPUT -p udp --dport 69 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 53 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 53 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 67 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 5405 -m state --state NEW -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 5900 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 5901 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 5900 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 5901 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 111 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 111 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p tcp --dport 20048 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A INPUT -p udp --dport 20048 -m state --state NEW  -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p sctp  --dport 2049 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p tcp  --dport 2049 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p udp  --dport 2049 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p tcp  --dport 32803 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p udp  --dport 32769 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p tcp  --dport 662 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-I INPUT -p udp  --dport 662 -j ACCEPT' /etc/sysconfig/iptables
sed -i '10a\-A FORWARD -m physdev ! --physdev-is-bridged -j REJECT --reject-with icmp-host-prohibited' /etc/sysconfig/iptables

checkmodule -M -m -o selinux.mod /usr/share/isclouder/selinux.te 
semodule_package -o selinux.pp -m selinux.mod 
semodule -i selinux.pp 
rm -rf selinux.mod selinux.pp

sed -i  '/Listen 80/ c\Listen 6660' /etc/httpd/conf/httpd.conf

%end

